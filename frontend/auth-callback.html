<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title>Autenticación - Callback</title>
		<style>
			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				margin: 0;
				padding: 0;
				min-height: 100vh;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.container {
				background: white;
				padding: 2rem;
				border-radius: 12px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
				text-align: center;
				max-width: 400px;
				width: 90%;
			}

			.spinner {
				border: 4px solid #f3f3f3;
				border-top: 4px solid #667eea;
				border-radius: 50%;
				width: 40px;
				height: 40px;
				animation: spin 1s linear infinite;
				margin: 0 auto 1rem;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			.success {
				color: #28a745;
				font-size: 1.2rem;
				margin-bottom: 1rem;
			}

			.error {
				color: #dc3545;
				font-size: 1.2rem;
				margin-bottom: 1rem;
			}

			.user-info {
				background: #f8f9fa;
				padding: 1rem;
				border-radius: 8px;
				margin: 1rem 0;
				text-align: left;
			}

			.user-info h3 {
				margin: 0 0 0.5rem 0;
				color: #333;
			}

			.user-info p {
				margin: 0.25rem 0;
				color: #666;
			}

			.btn {
				background: #667eea;
				color: white;
				border: none;
				padding: 0.75rem 1.5rem;
				border-radius: 6px;
				cursor: pointer;
				font-size: 1rem;
				text-decoration: none;
				display: inline-block;
				margin: 0.5rem;
			}

			.btn:hover {
				background: #5a6fd8;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div id="loading">
				<div class="spinner"></div>
				<p>Procesando autenticación...</p>
			</div>

			<div
				id="success"
				style="display: none">
				<div class="success">✅ ¡Autenticación exitosa!</div>
				<div
					class="user-info"
					id="userInfo"></div>
				<a
					href="/profile.html"
					class="btn"
					>Ir al Perfil</a
				>
				<a
					href="/"
					class="btn"
					>Ir al Inicio</a
				>
			</div>

			<div
				id="error"
				style="display: none">
				<div class="error">❌ Error en la autenticación</div>
				<p id="errorMessage"></p>
				<a
					href="/login.html"
					class="btn"
					>Volver al Login</a
				>
			</div>
		</div>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				const urlParams = new URLSearchParams(window.location.search);
				const token = urlParams.get("token");
				const userParam = urlParams.get("user");

				if (!token || !userParam) {
					showError("Parámetros de autenticación faltantes");
					return;
				}

				try {
					const user = JSON.parse(decodeURIComponent(userParam));

					// Guardar token en localStorage
					localStorage.setItem("authToken", token);
					localStorage.setItem("user", JSON.stringify(user));

					// Mostrar información del usuario
					showSuccess(user);

					// Redirigir después de 3 segundos
					setTimeout(() => {
						window.location.href = "/profile.html";
					}, 3000);
				} catch (error) {
					console.error("Error procesando autenticación:", error);
					showError("Error procesando la respuesta de autenticación");
				}
			});

			function showSuccess(user) {
				document.getElementById("loading").style.display = "none";
				document.getElementById("success").style.display = "block";

				const userInfo = document.getElementById("userInfo");
				userInfo.innerHTML = `
                <h3>Bienvenido, ${user.firstName}!</h3>
                <p><strong>Email:</strong> ${user.email}</p>
                <p><strong>Nombre:</strong> ${user.firstName} ${
					user.lastName
				}</p>
                <p><strong>Rol:</strong> ${user.role}</p>
                ${
									user.avatar
										? `<img src="${user.avatar}" alt="Avatar" style="width: 50px; height: 50px; border-radius: 50%; margin-top: 0.5rem;">`
										: ""
								}
            `;
			}

			function showError(message) {
				document.getElementById("loading").style.display = "none";
				document.getElementById("error").style.display = "block";
				document.getElementById("errorMessage").textContent = message;
			}
		</script>
	</body>
</html>
